{
    "id": "Note-cc389043-27wp-18xq-6wx5-ll2w0w91w63w",
    "noteType": "DOCUMENTATION",
    "noteDate": 1733833688873,
    "nameLower": "database schema changes - march 2024",
    "parentId": "Folder-ss852w790-425w-13wx-5wx0-3179w0xx0282",
    "name": "Database Schema Changes - March 2024",
    "createdBy": {
        "id": "User-ss3xww0x-7x37-223x-61x5-7xxx1x3xx0080",
        "email": "rachel.kim@synergyos.com",
        "name": "Rachel Kim"
    },
    "modifiedBy": {
        "id": "User-ss3xww0x-7x37-223x-61x5-7xxx1x3xx0080",
        "email": "rachel.kim@synergyos.com",
        "name": "Rachel Kim"
    },
    "createdDateTime": 1715583282018,
    "modifiedDateTime": 1733833689187,
    "content": "<p style=\\\"margin: 0\\\">üìä Database Schema Changes</p><p style=\\\"margin: 0\\\">March 2024 Updates</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">1. User Profile Enhancements</p><p style=\\\"margin: 0\\\">-------------------------</p><p style=\\\"margin: 0\\\">Migration: `20240315_user_profiles`</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">-- Add new columns to users table</p><p style=\\\"margin: 0\\\">ALTER TABLE users</p><p style=\\\"margin: 0\\\">ADD COLUMN timezone VARCHAR(50),</p><p style=\\\"margin: 0\\\">ADD COLUMN theme_preference JSONB DEFAULT '{\\\"mode\\\": \\\"light\\\"}'::jsonb,</p><p style=\\\"margin: 0\\\">ADD COLUMN notification_settings JSONB DEFAULT '{\\\"email\\\": true, \\\"push\\\": true}'::jsonb;</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Create user preferences table</p><p style=\\\"margin: 0\\\">CREATE TABLE user_preferences (</p><p style=\\\"margin: 0\\\">    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),</p><p style=\\\"margin: 0\\\">    user_id UUID REFERENCES users(id),</p><p style=\\\"margin: 0\\\">    category VARCHAR(50) NOT NULL,</p><p style=\\\"margin: 0\\\">    settings JSONB NOT NULL,</p><p style=\\\"margin: 0\\\">    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,</p><p style=\\\"margin: 0\\\">    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP</p><p style=\\\"margin: 0\\\">);</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Add indexes</p><p style=\\\"margin: 0\\\">CREATE INDEX idx_user_preferences_user_id ON user_preferences(user_id);</p><p style=\\\"margin: 0\\\">CREATE INDEX idx_user_preferences_category ON user_preferences(category);</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">Rollback:</p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">DROP TABLE user_preferences;</p><p style=\\\"margin: 0\\\">ALTER TABLE users</p><p style=\\\"margin: 0\\\">DROP COLUMN timezone,</p><p style=\\\"margin: 0\\\">DROP COLUMN theme_preference,</p><p style=\\\"margin: 0\\\">DROP COLUMN notification_settings;</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">2. Note Tagging System</p><p style=\\\"margin: 0\\\">--------------------</p><p style=\\\"margin: 0\\\">Migration: `20240318_note_tags`</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">-- Create tags table</p><p style=\\\"margin: 0\\\">CREATE TABLE tags (</p><p style=\\\"margin: 0\\\">    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),</p><p style=\\\"margin: 0\\\">    name VARCHAR(50) NOT NULL,</p><p style=\\\"margin: 0\\\">    color VARCHAR(7) DEFAULT '#808080',</p><p style=\\\"margin: 0\\\">    created_by UUID REFERENCES users(id),</p><p style=\\\"margin: 0\\\">    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP</p><p style=\\\"margin: 0\\\">);</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Create note_tags junction table</p><p style=\\\"margin: 0\\\">CREATE TABLE note_tags (</p><p style=\\\"margin: 0\\\">    note_id UUID REFERENCES notes(id) ON DELETE CASCADE,</p><p style=\\\"margin: 0\\\">    tag_id UUID REFERENCES tags(id) ON DELETE CASCADE,</p><p style=\\\"margin: 0\\\">    added_by UUID REFERENCES users(id),</p><p style=\\\"margin: 0\\\">    added_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,</p><p style=\\\"margin: 0\\\">    PRIMARY KEY (note_id, tag_id)</p><p style=\\\"margin: 0\\\">);</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Add indexes</p><p style=\\\"margin: 0\\\">CREATE UNIQUE INDEX idx_tags_name ON tags(lower(name));</p><p style=\\\"margin: 0\\\">CREATE INDEX idx_note_tags_tag_id ON note_tags(tag_id);</p><p style=\\\"margin: 0\\\">CREATE INDEX idx_note_tags_added_by ON note_tags(added_by);</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">Rollback:</p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">DROP TABLE note_tags;</p><p style=\\\"margin: 0\\\">DROP TABLE tags;</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">3. Search Improvements</p><p style=\\\"margin: 0\\\">-------------------</p><p style=\\\"margin: 0\\\">Migration: `20240320_search_improvements`</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">-- Add full-text search columns</p><p style=\\\"margin: 0\\\">ALTER TABLE notes</p><p style=\\\"margin: 0\\\">ADD COLUMN search_vector tsvector,</p><p style=\\\"margin: 0\\\">ADD COLUMN metadata JSONB DEFAULT '{}'::jsonb;</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Create search index</p><p style=\\\"margin: 0\\\">CREATE INDEX idx_notes_search ON notes USING gin(search_vector);</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Update trigger function</p><p style=\\\"margin: 0\\\">CREATE OR REPLACE FUNCTION notes_search_trigger() RETURNS trigger AS $$</p><p style=\\\"margin: 0\\\">BEGIN</p><p style=\\\"margin: 0\\\">  NEW.search_vector :=</p><p style=\\\"margin: 0\\\">    setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||</p><p style=\\\"margin: 0\\\">    setweight(to_tsvector('english', COALESCE(NEW.content, '')), 'B');</p><p style=\\\"margin: 0\\\">  RETURN NEW;</p><p style=\\\"margin: 0\\\">END</p><p style=\\\"margin: 0\\\">$$ LANGUAGE plpgsql;</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">-- Create trigger</p><p style=\\\"margin: 0\\\">CREATE TRIGGER notes_search_update</p><p style=\\\"margin: 0\\\">  BEFORE INSERT OR UPDATE ON notes</p><p style=\\\"margin: 0\\\">  FOR EACH ROW</p><p style=\\\"margin: 0\\\">  EXECUTE FUNCTION notes_search_trigger();</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">Rollback:</p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">DROP TRIGGER notes_search_update ON notes;</p><p style=\\\"margin: 0\\\">DROP FUNCTION notes_search_trigger;</p><p style=\\\"margin: 0\\\">DROP INDEX idx_notes_search;</p><p style=\\\"margin: 0\\\">ALTER TABLE notes</p><p style=\\\"margin: 0\\\">DROP COLUMN search_vector,</p><p style=\\\"margin: 0\\\">DROP COLUMN metadata;</p><p style=\\\"margin: 0\\\">```</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">‚ö†Ô∏è Migration Notes:</p><p style=\\\"margin: 0\\\">1. Backup database before running migrations</p><p style=\\\"margin: 0\\\">2. Run during low-traffic hours</p><p style=\\\"margin: 0\\\">3. Update application code to handle new columns</p><p style=\\\"margin: 0\\\">4. Monitor query performance after changes</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">üìä Database Stats:</p><p style=\\\"margin: 0\\\">```sql</p><p style=\\\"margin: 0\\\">-- Current table sizes</p><p style=\\\"margin: 0\\\">SELECT</p><p style=\\\"margin: 0\\\">    relname as table_name,</p><p style=\\\"margin: 0\\\">    pg_size_pretty(pg_total_relation_size(relid)) as total_size,</p><p style=\\\"margin: 0\\\">    pg_size_pretty(pg_indexes_size(relid)) as index_size</p><p style=\\\"margin: 0\\\">FROM pg_catalog.pg_statio_user_tables</p><p style=\\\"margin: 0\\\">ORDER BY pg_total_relation_size(relid) DESC;</p><p style=\\\"margin: 0\\\">```</p>",
    "bodyPreview": "<p style=\\\"margin: 0\\\">üìä Database Schema Changes</p><p style=\\\"margin: 0\\\">March 2024 Updates</p><p style=\\\"margin: 0\\\"></p><p style=\\\"margin: 0\\\">1. User Profile Enhancements</p><p style=\\\"margin: 0\\\">-------------------------</p>",
    "repo": "Repo-7032f89f-1805-46b7-8f9f-d74ccffe0827",
    "deleted_at": 0,
    "pathIds": "Repo-7032f89f-1805-46b7-8f9f-d74ccffe0827/Folder-ss852w790-425w-13wx-5wx0-3179w0xx0282",
    "pathNames": "SynergyOS/Engineering/Database",
    "thumbnailCreated": false,
    "colorTag": 0
} 